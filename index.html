<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>English Reading Practice</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>

<body>
  <h2>ğŸ“– Read and Repeat</h2>

  <p style="font-size:20px;">
    ğŸ‘‰ I like learning English.
  </p>

  <button onclick="playModel()">ğŸ”Š Listen</button>

  <hr>

  <button id="startBtn" disabled>ğŸ¤ Start Recording</button>
  <button id="stopBtn" disabled>â¹ Stop</button>

  <audio id="audio" controls></audio>

<script>
  // åˆå§‹åŒ– LIFFï¼ˆéå¸¸é‡è¦ï¼‰
  async function initLIFF() {
    await liff.init({ liffId: 2009077149-jA6ZHUPf });
    document.getElementById("startBtn").disabled = false;
  }

  initLIFF();

  // æ ‡å‡†éŸ³
  const modelAudio = new Audio("model.mp3");
  function playModel() {
    modelAudio.play();
  }

  let mediaRecorder;
  let audioChunks = [];

  document.getElementById("startBtn").onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.start();

    audioChunks = [];
    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

    startBtn.disabled = true;
    stopBtn.disabled = false;
  };

  document.getElementById("stopBtn").onclick = () => {
    mediaRecorder.stop();
    mediaRecorder.onstop = () => {
      const blob = new Blob(audioChunks, { type: "audio/webm" });
      audio.src = URL.createObjectURL(blob);
    };

    startBtn.disabled = false;
    stopBtn.disabled = true;
  };
</script>
</body>
</html>
